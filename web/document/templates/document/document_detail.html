{% extends 'base.html' %}
{% block body_block %}
    <div class="card">
        <div class="card-header">
            <h4>{{ document.interview }}</h4>
            <h5>{{ document.name }}</h5>
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <span class="font-weight-bold">Escola: </span>{{ document.school }}</li>
                <li class="list-group-item">
                    {# documentacao do django para formatacao de data no template #}
                    {# https://docs.djangoproject.com/en/3.0/ref/templates/builtins/#date #}
                    <span class="font-weight-bold">Data de Criação: </span>{{ document.created_date|date:"d/m/Y H:i:s" }}
                </li>
                {% if user.tenant.plan.use_ged or user.tenant.plan.use_esignature %}
                    <li class="list-group-item">
                        <span class="font-weight-bold">Data de Alteração: </span>{{ document.altered_date|date:"d/m/Y H:i:s" }}
                    </li>
                {% endif %}
                <li class="list-group-item">
                    <span class="font-weight-bold">Status: </span>{{ document.status }}</li>
                {% if user.tenant.plan.use_esignature %}
                    <li class="list-group-item">
                        <span class="font-weight-bold">Envelope ID: </span>{{ document.envelope_id|default:"-" }}</li>
                    <li class="list-group-item">
                        <span class="font-weight-bold">Provedor: </span>{{ document.signing_provider|default:"-" }}</li>
                {% endif %}
                {% if user.tenant.plan.use_ged %}
                    <li class="list-group-item">
                        <span class="font-weight-bold">Link: </span><a href="{{ document.ged_link }}"
                                                                       target="_blank">{{ document.ged_link }}</a></li>
                {% endif %}
                <li class="list-group-item">
                    <span class="font-weight-bold">Descrição: </span>{{ document.description|default:"-" }}</li>
            </ul>
        </div>

        {% if document.envelope_logs.all %}
            <div class="card-header">
                <h5>Detalhes do Envelope</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {% for envelope_log in document.envelope_logs.all %}
                        <li class="list-group-item">
                            <span class="font-weight-bold">Data de criação: </span>{{ envelope_log.envelope_created_date|date:"d/m/Y H:i:s" }}
                        </li>
                        <li class="list-group-item">
                            <span class="font-weight-bold">Data de alteração: </span>{{ envelope_log.status_update_date|date:"d/m/Y H:i:s"|default:"-" }}
                        </li>
                        <li class="list-group-item">
                            <span class="font-weight-bold">Data do envio: </span>{{ envelope_log.sent_date|date:"d/m/Y H:i:s"|default:"-" }}
                        </li>
                        <li class="list-group-item">
                            <span class="font-weight-bold">Status: </span>{{ envelope_log.status }}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% for envelope_log in document.envelope_logs.all %}
            <div class="card-header">
              <h5>Detalhes dos Destinatários</h5>
            </div>
            <br/>
            <div class="card-deck">
              <div class="row">
                {% for signer_log in envelope_log.signer_logs.all %}
                  <div class="col-sm-4">
                    <div class="card mb-3 border-{{ signer_log.status }}">
                      <div class="card-header header-{{ signer_log.status }}">
                        <b>{{ signer_log.status|title }}</b>
                      </div>
                      <div class="card-body">
                        <h5 class="card-title">{{ signer_log.name }}</h5>
                        <p class="card-text">E-mail: {{ signer_log.email }}</p>
                        <p class="card-text">Criação: {{ signer_log.created_date|date:"d/m/Y H:i:s" }}</p>
                        <p class="card-text">Envio: {{ signer_log.sent_date|date:"d/m/Y H:i:s"|default:"-" }}</p>
                        <p class="card-text">Tipo: {{ signer_log.type }}</p>
                        {% if signer_log.pdf_filenames %}
                          <p class="card-text">PDFs: {{ signer_log.pdf_filenames|linebreaks }}</p>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
        {% endfor %}

        <br/>
        {% if document.documents.all %}
            <div class="card-header">
                <h5>Documentos Relacionados</h5>
            </div>
            <br/>
            <ul>
                {% for related_document in document.documents.all %}
                    <li><a href="{% url 'document:document-detail' pk=related_document.pk %}"
                           target="_blank">{{ related_document.name }}</a></li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    <script type="text/javascript">
        $.each({{ signer_statuses }}, function(index, signer_status) {
          if (signer_status == 'criado') {
            $(".border-criado").addClass("border-primary");
            $(".header-criado").addClass("bg-primary");
          } else if (signer_status == 'enviado') {
            $(".border-enviado").addClass("border-info");
            $(".header-enviado").addClass("bg-info");
          } else if (signer_status == 'entregue') {
            $(".border-entregue").addClass("border-warning");
            $(".header-entregue").addClass("bg-warning");
          } else if (signer_status == 'finalizado') {
            $(".border-finalizado").addClass("border-success");
            $(".header-finalizado").addClass("bg-success");
          } else if (signer_status == 'recusado' || signer_status == 'inválido') {
            $(".border-recusado").addClass("border-danger");
            $(".header-recusado").addClass("bg-danger");
            $(".border-inválido").addClass("border-danger");
            $(".header-inválido").addClass("bg-danger");
          }
          $(".border-" + signer_status).removeClass("border-" + signer_status);
          $(".header-" + signer_status).removeClass("header-" + signer_status);
        });
    </script>
{% endblock %}