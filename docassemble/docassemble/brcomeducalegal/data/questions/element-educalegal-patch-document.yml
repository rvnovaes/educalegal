---
modules:
  - .element_educalegal_client
---
include:
  - element-custom-file-name.yml
---
code: |
  import json

  # private=False - para que o arquivo fique acessivel fora do docassemble
  generated_file.pdf.set_attributes(private=False)
  generated_file.docx.set_attributes(private=False)

  data = {
     "description": interview_description,
     "status": "criado",
     "school": school_id,
     "document_type": interview_document_type,
     "related_documents": None,
     "document_data": json.dumps(all_variables())
  }

  # external=True - acrescenta na url o protocolo and hostname (https://hostname)
  params = {
      "trigger": "docassemble",
      "pdf_url": generated_file.pdf.url_for(external=True),
      "pdf_filename": custom_file_name + '.pdf',
      "docx_url": generated_file.docx.url_for(external=True),
      "docx_filename": custom_file_name + '.docx',
      "tenant_id": tid,
      "doc_uuid": doc_uuid,
  }

  # atualiza no educa legal dados do documento gerado
  status_code, el_patch_document = elc.patch_document(data, params)
  if status_code == 200:
    log("Atualizado o documento")
  else:
    log("Erro ao atualizar o documento")
  log("{doc_uuid} - {data}".format(doc_uuid=doc_uuid, data=el_patch_document))
