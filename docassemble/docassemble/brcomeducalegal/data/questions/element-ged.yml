---
modules:
  - .element_mayan_client
  - .element_educalegal_client
---
include:
  - element-custom-file-name.yml
  - element-generate-file.yml
---
code: |
  mc = MayanClient(tenant_ged_url, tenant_ged_token)
  if el_log_to_console:
    log("Criado Mayan Client para {tenant_ged_url} com o token {tenant_ged_token}".format(tenant_ged_url=tenant_ged_url, tenant_ged_token=tenant_ged_token), "console")
  log("Criado Mayan Client para {tenant_ged_url} com o token {tenant_ged_token}".format(tenant_ged_url=tenant_ged_url, tenant_ged_token=tenant_ged_token))
  mayan_file_name = custom_file_name + '.pdf'
  if el_log_to_console:
    log("Tentando inserir no Mayan o documento: " + mayan_file_name, "console")
  log("Tentando inserir no Mayan o documento: " + mayan_file_name)
  ged_response_status_code, ged_response, ged_id = mc.document_create_message_docid(generated_file.pdf.path(), interview_document_type, mayan_file_name, interview_language, interview_description)

  if el_log_to_console:
    log("ged_response_status_code: {ged_response_status_code} - ged_response: {ged_response} - ged_id: {ged_id}".format(ged_response_status_code=ged_response_status_code, ged_response=ged_response, ged_id=ged_id), "console")
  log("ged_response_status_code: {ged_response_status_code} - ged_response: {ged_response} - ged_id: {ged_id}".format(ged_response_status_code=ged_response_status_code, ged_response=ged_response, ged_id=ged_id))
  if el_log_to_console:
    log("ged_response_status_code: {ged_response_status_code} - ged_response: {ged_response} - ged_id: {ged_id}".format(ged_response_status_code=ged_response_status_code, ged_response=ged_response, ged_id=ged_id), "console")

  mayan_document_data = mc.document_read(ged_id)
  log("mayan_document_data: {mayan_document_data}".format(mayan_document_data=mayan_document_data))
  if el_log_to_console:
    log("mayan_document_data: {mayan_document_data}".format(mayan_document_data=mayan_document_data), "console")
  cd_ged_id = mayan_document_data['id']
  cd_ged_link = mayan_document_data['latest_version']['download_url']
  cd_ged_uuid = mayan_document_data['uuid']
  cd_status = "inserido no GED"
  el_document_patched_with_ged_data = elc.patch_document_with_ged_data(doc_uuid, cd_ged_id, cd_ged_link, cd_ged_uuid, cd_status)
  log("el_document_patched_with_ged_data: {el_document_patched_with_ged_data}".format(el_document_patched_with_ged_data=el_document_patched_with_ged_data))
  if el_log_to_console:
    log("el_document_patched_with_ged_data: {el_document_patched_with_ged_data}".format(el_document_patched_with_ged_data=el_document_patched_with_ged_data), "console")
  if isinstance(el_document_patched_with_ged_data, str):
    ged_update_error
---
event: ged_update_error
question: Atualização dos dados do GED
subquestion: |
  Não foi possível atualizar os dados do GED no Educa Legal.
  Contate nosso suporte para ajuda.
  Acesse o chat no <a href="https://www.educalegal.com.br" target="_blank">nosso site</a>.

  Erro: ${ el_document_patched_with_ged_data }
buttons:
  - Sair: exit